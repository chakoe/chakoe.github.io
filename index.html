<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‰å¤©ä¸ºä¸€åœ©æ—¥å† - é¢„è§ˆç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            padding: 25px;
            margin: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .title {
            font-size: 28px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 8px;
        }
        
        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, #2196F3, transparent);
            margin: 20px 0;
        }
        
        .date-section {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .current-date {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
        }
        
        .market-status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .status-text {
            font-size: 22px;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        
        .market-day {
            color: #4CAF50;
        }
        
        .normal-day {
            color: #FF5722;
        }
        
        .market-icon {
            font-size: 28px;
            color: #4CAF50;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        .next-market {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .days-left {
            font-size: 18px;
            color: #2196F3;
            margin-bottom: 8px;
        }
        
        .next-date {
            font-size: 16px;
            color: #666;
        }
        
        .history-section {
            margin-top: 20px;
        }
        
        .history-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }
        
        .history-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .history-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .history-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .history-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .history-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: #f8f9fa;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .record-item:last-child {
            margin-bottom: 0;
        }
        
        .record-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .market-record {
            background: #e8f5e8;
            border-left: 4px solid #4CAF50;
        }
        
        .normal-record {
            background: #f5f5f5;
            border-left: 4px solid #ccc;
        }
        
        .record-date {
            font-weight: 500;
            font-size: 14px;
        }
        
        .market-date {
            color: #4CAF50;
        }
        
        .normal-date {
            color: #666;
        }
        
        .record-type {
            font-size: 13px;
        }
        
        .market-type {
            color: #4CAF50;
        }
        
        .normal-type {
            color: #999;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 5px;
            }
            
            .title {
                font-size: 24px;
            }
            
            .status-text {
                font-size: 20px;
            }
            
            .market-icon {
                font-size: 24px;
            }
            
            .current-date,
            .days-left,
            .next-date {
                font-size: 14px;
            }
            
            .history-title {
                font-size: 16px;
            }
            
            .history-list {
                max-height: 200px;
            }
            
            .record-item {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">èµ¶åœ©æ—¥å†</div>
        </div>
        
        <div class="divider"></div>
        
        <div class="date-section">
            <div class="current-date" id="currentDate">å½“å‰æ—¥æœŸ: åŠ è½½ä¸­...</div>
            
            <!-- æ·»åŠ æ—¥æœŸé€‰æ‹©å™¨ -->
            <div style="margin-bottom: 15px;">
                <input type="date" id="datePicker" style="
                    width: 100%;
                    padding: 10px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 16px;
                    background: white;
                    cursor: pointer;
                ">
            </div>
            
            <div class="market-status">
                <div class="status-text" id="marketStatus">åŠ è½½ä¸­...</div>
                <div class="market-icon" id="marketIcon" style="display: none;">ğŸª</div>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="next-market">
            <div class="days-left" id="daysLeft">è·ç¦»ä¸‹ä¸€ä¸ªåœ©æ—¥è¿˜æœ‰: è®¡ç®—ä¸­...</div>
            <div class="next-date" id="nextDate">ä¸‹ä¸€ä¸ªåœ©æ—¥: è®¡ç®—ä¸­...</div>
        </div>
        
        <div class="divider"></div>
        
        <div class="history-section">
            <div class="history-title">å†å²åœ©æ—¥è®°å½•</div>
            <div class="history-list" id="historyList">
                <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // åœ©æ—¥è®°å½•ç±»
        class MarketDayRecord {
            constructor(date, isMarketDay, period, note) {
                this.date = date;
                this.isMarketDay = isMarketDay;
                this.period = period;
                this.note = note;
            }
        }

        // é…ç½®å¸¸é‡
        const CONFIG = {
            baseDate: new Date(Date.UTC(2025, 10, 12)), // å¤ªå®ˆåŸºå‡†æ—¥ï¼ˆä½¿ç”¨UTCæ—¶é—´ï¼‰
            marketNames: ['å¤ªå®ˆ', 'æ–°æ¡¥', 'èŠ¦åœ©'],
            defaultHistoryDays: 30
        };

        // å·¥å…·å‡½æ•°ï¼šè·å–å½“å‰æ—¥æœŸå­—ç¬¦ä¸² (YYYY-MM-DD)
        function getCurrentDateString(date = new Date()) {
            // å‚æ•°éªŒè¯
            if (!(date instanceof Date) || isNaN(date.getTime())) {
                console.error('getCurrentDateStringå‡½æ•°éœ€è¦æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡å‚æ•°');
                date = new Date();
            }
            
            // ä½¿ç”¨UTCæ—¶é—´ç¡®ä¿æ—¥æœŸæ ¼å¼çš„ä¸€è‡´æ€§
            return `${date.getUTCFullYear()}-${(date.getUTCMonth() + 1).toString().padStart(2, '0')}-${date.getUTCDate().toString().padStart(2, '0')}`;
        }

        // å·¥å…·å‡½æ•°ï¼šå°†æ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ—¥æœŸå¯¹è±¡
        function parseDateString(dateString) {
            // å‚æ•°éªŒè¯
            if (typeof dateString !== 'string') {
                console.error('parseDateStringå‡½æ•°éœ€è¦å­—ç¬¦ä¸²å‚æ•°');
                return new Date();
            }
            
            // éªŒè¯æ—¥æœŸæ ¼å¼ (YYYY-MM-DD)
            const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
            if (!dateRegex.test(dateString)) {
                console.error('æ— æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼Œåº”ä¸ºYYYY-MM-DD:', dateString);
                return new Date();
            }
            
            const parts = dateString.split('-');
            const year = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; // æœˆä»½ä»0å¼€å§‹
            const day = parseInt(parts[2], 10);
            
            // ä½¿ç”¨UTCæ—¶é—´åˆ›å»ºæ—¥æœŸå¯¹è±¡ï¼Œé¿å…æ—¶åŒºé—®é¢˜
            return new Date(Date.UTC(year, month, day));
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–ä¸­æ–‡æ˜ŸæœŸ
        function getChineseDayOfWeek(date) {
            // å‚æ•°éªŒè¯ï¼Œç¡®ä¿ä¼ å…¥çš„æ˜¯æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡
            if (!(date instanceof Date) || isNaN(date.getTime())) {
                console.error('getChineseDayOfWeekå‡½æ•°éœ€è¦æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡å‚æ•°');
                return 'æœªçŸ¥';
            }
            
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            return weekdays[date.getDay()];
        }

        // è®¡ç®—æŒ‡å®šæ—¥æœŸçš„åœ©æ—¥ä¿¡æ¯
        function calculateMarketDayInfo(targetDate) {
            // å‚æ•°éªŒè¯ï¼Œç¡®ä¿ä¼ å…¥çš„æ˜¯æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡
            if (!(targetDate instanceof Date) || isNaN(targetDate.getTime())) {
                console.error('calculateMarketDayInfoå‡½æ•°éœ€è¦æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡å‚æ•°');
                return null;
            }
            
            // ç¡®ä¿ä½¿ç”¨UTCæ—¶é—´è¿›è¡Œè®¡ç®—ï¼Œé¿å…æ—¶åŒºé—®é¢˜
            const target = new Date(targetDate);
            
            // è®¾ç½®ä¸ºUTCæ—¶é—´ï¼Œç¡®ä¿æ—¶åŒºä¸€è‡´æ€§
            const targetUTC = Date.UTC(target.getUTCFullYear(), target.getUTCMonth(), target.getUTCDate());
            const baseUTC = CONFIG.baseDate.getTime(); // CONFIG.baseDateå·²ç»æ˜¯UTCæ—¶é—´
            
            // è®¡ç®—å¤©æ•°å·®
            const diffTime = targetUTC - baseUTC;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            // è®¡ç®—åœ©æ—¥åç§°ç´¢å¼• (0: å¤ªå®ˆ, 1: æ–°æ¡¥, 2: èŠ¦åœ©)
            const marketNameIndex = ((diffDays % 3) + 3) % 3; // å¤„ç†è´Ÿæ•°æƒ…å†µ
            
            // è®¡ç®—ä¸‹ä¸€ä¸ªåœ©æ—¥ï¼ˆä½¿ç”¨UTCæ—¶é—´ï¼‰
            const nextDateUTC = new Date(targetUTC + 24 * 60 * 60 * 1000); // åŠ ä¸€å¤©çš„æ¯«ç§’æ•°
            const nextDate = new Date(nextDateUTC);
            const nextMarketNameIndex = (marketNameIndex + 1) % 3;
            
            return {
                date: target,
                dateString: getCurrentDateString(target),
                isMarketDay: true, // æ¯å¤©éƒ½æ˜¯åœ©æ—¥
                marketName: CONFIG.marketNames[marketNameIndex],
                marketNameIndex: marketNameIndex,
                nextMarketDate: nextDate,
                nextMarketDateString: getCurrentDateString(nextDate),
                nextMarketName: CONFIG.marketNames[nextMarketNameIndex],
                nextMarketNameIndex: nextMarketNameIndex,
                daysToNextMarket: 1
            };
        }

        // ç”Ÿæˆå†å²åœ©æ—¥è®°å½•
        function generateMarketDayRecords(endDate = new Date(), days = CONFIG.defaultHistoryDays) {
            // å‚æ•°éªŒè¯ï¼Œç¡®ä¿ä¼ å…¥çš„æ˜¯æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡
            if (!(endDate instanceof Date) || isNaN(endDate.getTime())) {
                console.error('generateMarketDayRecordså‡½æ•°éœ€è¦æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡å‚æ•°');
                endDate = new Date();
            }
            
            const records = [];
            
            // ç¡®ä¿ä½¿ç”¨UTCæ—¶é—´è¿›è¡Œè®¡ç®—
            const endDateUTC = Date.UTC(endDate.getUTCFullYear(), endDate.getUTCMonth(), endDate.getUTCDate());
            
            for (let i = 0; i <= days; i++) {
                // ä½¿ç”¨UTCæ—¶é—´ç¡®ä¿æ—¥æœŸè®¡ç®—çš„å‡†ç¡®æ€§
                const targetDateUTC = endDateUTC - (i * 24 * 60 * 60 * 1000); // å‡å»iå¤©çš„æ¯«ç§’æ•°
                const targetDate = new Date(targetDateUTC);
                
                const info = calculateMarketDayInfo(targetDate);
                if (info) { // ç¡®ä¿infoä¸ä¸ºnull
                    records.push(new MarketDayRecord(
                        info.dateString,
                        info.isMarketDay,
                        info.marketNameIndex,
                        `${info.marketName}åœ©æ—¥`
                    ));
                }
            }
            
            return records;
        }

        // æ›´æ–°é¡µé¢æ˜¾ç¤º
        function updateDisplay(targetDate) {
            // ç¡®ä¿targetDateå§‹ç»ˆæ˜¯æœ‰æ•ˆçš„æ—¥æœŸå¯¹è±¡
            targetDate = targetDate instanceof Date && !isNaN(targetDate.getTime()) ? targetDate : new Date();
            const currentDateString = getCurrentDateString(new Date());
            const selectedDateString = getCurrentDateString(targetDate);
            const selectedWeekday = getChineseDayOfWeek(targetDate);
            const marketData = calculateMarketDayInfo(targetDate);
            const records = generateMarketDayRecords(targetDate);

            // æ›´æ–°å½“å‰æ—¥æœŸæ˜¾ç¤ºï¼Œæ·»åŠ æ˜ŸæœŸä¿¡æ¯
            if (selectedDateString === currentDateString) {
                document.getElementById('currentDate').textContent = `å½“å‰æ—¥æœŸ: ${selectedDateString} æ˜ŸæœŸ: ${selectedWeekday}`;
            } else {
                document.getElementById('currentDate').textContent = `é€‰æ‹©æ—¥æœŸ: ${selectedDateString} æ˜ŸæœŸ: ${selectedWeekday}`;
            }

            // æ›´æ–°åœ©æ—¥çŠ¶æ€
            const marketStatus = document.getElementById('marketStatus');
            const marketIcon = document.getElementById('marketIcon');
            
            marketStatus.textContent = `${selectedDateString === currentDateString ? 'ä»Šå¤©' : 'å½“å¤©'}${marketData.marketName}åœ©æ—¥`;
            marketStatus.className = 'status-text market-day';
            marketIcon.style.display = 'block';

            // æ›´æ–°ä¸‹ä¸€ä¸ªåœ©æ—¥ä¿¡æ¯
            if (selectedDateString === currentDateString) {
                document.getElementById('daysLeft').textContent = `è·ç¦»ä¸‹ä¸€ä¸ªåœ©æ—¥è¿˜æœ‰: ${marketData.daysToNextMarket}å¤©`;
            } else {
                document.getElementById('daysLeft').textContent = `ä¸‹ä¸€ä¸ªåœ©æ—¥è¿˜æœ‰: ${marketData.daysToNextMarket}å¤©`;
            }
            document.getElementById('nextDate').textContent = `ä¸‹ä¸€ä¸ªåœ©æ—¥: ${marketData.nextMarketDateString} (${marketData.nextMarketName})`;

            // æ›´æ–°å†å²è®°å½•
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            records.forEach(record => {
                const recordDiv = document.createElement('div');
                recordDiv.className = `record-item ${record.isMarketDay ? 'market-record' : 'normal-record'}`;
                
                recordDiv.innerHTML = `
                    <span class="record-date ${record.isMarketDay ? 'market-date' : 'normal-date'}">
                        ${record.date}
                    </span>
                    <span class="record-type ${record.isMarketDay ? 'market-type' : 'normal-type'}">
                        ${record.note}
                    </span>
                `;
                
                historyList.appendChild(recordDiv);
            });
        }

        // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
        function initializeDatePicker() {
            const datePicker = document.getElementById('datePicker');
            const today = new Date();
            const todayString = getCurrentDateString(today);
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä¸Šæ¬¡é€‰æ‹©çš„æ—¥æœŸ
            const savedDate = localStorage.getItem('selectedMarketDate');
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸï¼ˆä¼˜å…ˆä½¿ç”¨ä¿å­˜çš„æ—¥æœŸï¼Œå¦åˆ™ä½¿ç”¨ä»Šå¤©ï¼‰
            if (savedDate) {
                // éªŒè¯ä¿å­˜çš„æ—¥æœŸæ ¼å¼æ˜¯å¦æ­£ç¡®
                const dateRegex = /^\d{4}-\d{2}-\d{2}$/;
                if (dateRegex.test(savedDate)) {
                    datePicker.value = savedDate;
                    updateDisplay(parseDateString(savedDate));
                } else {
                    console.error('ä¿å­˜çš„æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®:', savedDate);
                    localStorage.removeItem('selectedMarketDate');
                    datePicker.value = todayString;
                    updateDisplay(today);
                }
            } else {
                datePicker.value = todayString;
                updateDisplay(today);
            }
            
            // æ·»åŠ æ—¥æœŸé€‰æ‹©äº‹ä»¶ç›‘å¬å™¨
            datePicker.addEventListener('change', function() {
                const selectedDate = parseDateString(this.value);
                updateDisplay(selectedDate);
                
                // å°†é€‰æ‹©çš„æ—¥æœŸä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('selectedMarketDate', this.value);
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨
            initializeDatePicker();
            
            // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡å½“å‰æ—¶é—´ï¼ˆå¦‚æœæ˜¾ç¤ºçš„æ˜¯å½“å‰æ—¥æœŸï¼‰
            const datePicker = document.getElementById('datePicker');
            const today = getCurrentDateString(new Date());
            
            setInterval(() => {
                if (datePicker.value === today) {
                    updateDisplay();
                }
            }, 60000);
        });

        // æ·»åŠ ç‚¹å‡»æ•ˆæœ
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('record-item')) {
                e.target.style.transform = 'scale(0.98)';
                setTimeout(() => {
                    e.target.style.transform = 'scale(1)';
                }, 150);
            }
        });
    </script>
</body>
</html>
